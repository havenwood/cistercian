<h1>Cistercian Numerals</h1>

<search class="controls">
  <input
    type="text"
    name="input"
    id="number_input"
    value="<%= @initial_input %>"
    placeholder="Type numbers separated by any character (0-9999)..."
    hx-post="/numerals"
    hx-trigger="input changed delay:100ms"
    hx-target="#numerals"
    hx-swap="morph:innerHTML"
    hx-include="[name='secret_mode']"
    autocomplete="one-time-code"
    data-form-type="other"
    data-lpignore="true"
    autofocus
  >
  <label class="toggle toggle-right">
    <input type="checkbox" name="secret_mode" value="1"
      hx-post="/numerals"
      hx-trigger="change"
      hx-target="#numerals"
      hx-swap="morph:innerHTML"
      hx-include="[name='input']"
      onchange="toggleSecretMode()"
    >
    <span class="slider"></span>
  </label>
</search>
<script>
  function toggleSecretMode() {
    const input = document.getElementById('number_input');
    const secret = document.querySelector('[name="secret_mode"]').checked;
    input.classList.toggle('hidden-text', secret);
  }

  document.addEventListener('DOMContentLoaded', () => {
    const input = document.getElementById('number_input');
    const secretMode = document.querySelector('[name="secret_mode"]');

    // Escape key clears input
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        input.value = '';
        htmx.ajax('POST', '/numerals', {
          target: '#numerals',
          swap: 'morph:innerHTML',
          values: { input: '', secret_mode: secretMode.checked ? '1' : '0' }
        });
      }
    });
  });
</script>

<main id="numerals"><%= @initial_numerals %></main>
